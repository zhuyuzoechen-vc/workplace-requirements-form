<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workplace Special Requirements — Deep Dive</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #F7F5F0;
    --surface: #FFFFFF;
    --ink: #1C1A17;
    --ink-muted: #6B6760;
    --accent: #1A4C3B;
    --accent-light: #E8F0ED;
    --accent-mid: #2E7D60;
    --warning: #B85042;
    --warning-light: #FDF0EE;
    --border: #DDD9D2;
    --gold: #C8A96E;
    --tag-standard: #2E7D60;
    --tag-exception: #B85042;
    --radius: 12px;
    --radius-sm: 6px;
    --shadow: 0 2px 12px rgba(28,26,23,0.06), 0 1px 3px rgba(28,26,23,0.08);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    font-size: 15px;
    line-height: 1.6;
  }

  /* ── Layout ── */
  .shell {
    display: grid;
    grid-template-columns: 280px 1fr;
    min-height: 100vh;
  }

  /* ── Sidebar ── */
  .sidebar {
    background: var(--accent);
    color: white;
    padding: 40px 28px;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .sidebar-logo {
    font-family: 'DM Serif Display', serif;
    font-size: 20px;
    color: white;
    line-height: 1.2;
    margin-bottom: 8px;
    letter-spacing: -0.3px;
  }

  .sidebar-sub {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.5);
    margin-bottom: 40px;
  }

  .sidebar-nav {
    flex: 1;
  }

  .nav-section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1.8px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.4);
    margin-bottom: 12px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background 0.15s;
    margin-bottom: 2px;
    text-decoration: none;
    color: rgba(255,255,255,0.7);
    font-size: 13.5px;
  }

  .nav-item:hover { background: rgba(255,255,255,0.1); color: white; }
  .nav-item.active { background: rgba(255,255,255,0.15); color: white; font-weight: 500; }
  .nav-item.completed .nav-num { background: var(--gold); color: var(--accent); }
  .nav-item.has-exceptions .nav-num { background: #B85042; }

  .nav-num {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 600;
    flex-shrink: 0;
    transition: background 0.2s;
  }

  .nav-divider {
    border: none;
    border-top: 1px solid rgba(255,255,255,0.1);
    margin: 20px 0;
  }

  .sidebar-progress {
    margin-top: auto;
    padding-top: 24px;
    border-top: 1px solid rgba(255,255,255,0.1);
  }

  .progress-label {
    font-size: 11px;
    color: rgba(255,255,255,0.5);
    margin-bottom: 8px;
  }

  .progress-bar-track {
    background: rgba(255,255,255,0.15);
    border-radius: 999px;
    height: 4px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--gold);
    border-radius: 999px;
    transition: width 0.3s ease;
    width: 0%;
  }

  /* ── Main content ── */
  .main {
    padding: 60px 56px;
    max-width: 900px;
  }

  /* ── Section panels ── */
  .section-panel {
    display: none;
    animation: fadeSlide 0.3s ease;
  }

  .section-panel.active { display: block; }

  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ── Group info panel ── */
  .panel-header {
    margin-bottom: 36px;
  }

  .panel-tag {
    display: inline-block;
    font-size: 10.5px;
    font-weight: 600;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--accent-mid);
    background: var(--accent-light);
    padding: 4px 10px;
    border-radius: 999px;
    margin-bottom: 16px;
  }

  .panel-title {
    font-family: 'DM Serif Display', serif;
    font-size: 36px;
    letter-spacing: -0.5px;
    line-height: 1.15;
    color: var(--ink);
    margin-bottom: 14px;
  }

  .panel-description {
    font-size: 15.5px;
    color: var(--ink-muted);
    max-width: 640px;
    line-height: 1.65;
  }

  /* ── Standard solution card ── */
  .standard-card {
    background: var(--accent-light);
    border: 1px solid #C8DDD6;
    border-radius: var(--radius);
    padding: 24px 28px;
    margin-bottom: 28px;
  }

  .standard-card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }

  .standard-icon {
    width: 30px;
    height: 30px;
    background: var(--accent);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .standard-icon svg { width: 16px; height: 16px; color: white; }

  .standard-card-title {
    font-weight: 600;
    font-size: 13px;
    letter-spacing: 0.3px;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .standard-card p {
    font-size: 14.5px;
    color: #2C5C4A;
    line-height: 1.65;
    margin-bottom: 8px;
  }

  .standard-card p:last-child { margin-bottom: 0; }

  .standard-bullets {
    list-style: none;
    margin-top: 8px;
  }

  .standard-bullets li {
    font-size: 14px;
    color: #2C5C4A;
    padding: 3px 0 3px 18px;
    position: relative;
    line-height: 1.5;
  }

  .standard-bullets li::before {
    content: '→';
    position: absolute;
    left: 0;
    font-size: 12px;
    color: var(--accent-mid);
  }

  /* ── Exception gate ── */
  .exception-gate {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    padding: 24px 28px;
    margin-bottom: 24px;
  }

  .gate-question {
    font-weight: 600;
    font-size: 16px;
    color: var(--ink);
    margin-bottom: 6px;
  }

  .gate-hint {
    font-size: 13.5px;
    color: var(--ink-muted);
    margin-bottom: 18px;
  }

  .gate-options {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .gate-btn {
    padding: 10px 24px;
    border-radius: 8px;
    border: 2px solid var(--border);
    background: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s;
    color: var(--ink);
  }

  .gate-btn:hover { border-color: var(--accent); color: var(--accent); }

  .gate-btn.selected-yes {
    border-color: var(--warning);
    background: var(--warning-light);
    color: var(--warning);
  }

  .gate-btn.selected-no {
    border-color: var(--accent);
    background: var(--accent-light);
    color: var(--accent);
  }

  /* ── Exception form (revealed) ── */
  .exception-form {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
    animation: fadeSlide 0.25s ease;
  }

  .exception-form.visible { display: block; }

  .exception-alert {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    background: var(--warning-light);
    border: 1px solid #EAB8B0;
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    margin-bottom: 18px;
    font-size: 13.5px;
    color: #8B3328;
    line-height: 1.5;
  }

  .exception-alert svg { width: 16px; height: 16px; flex-shrink: 0; margin-top: 1px; color: var(--warning); }

  /* ── Standard form elements ── */
  .form-group {
    margin-bottom: 22px;
  }

  .form-label {
    display: block;
    font-weight: 500;
    font-size: 14px;
    color: var(--ink);
    margin-bottom: 7px;
  }

  .form-label span.required { color: var(--warning); margin-left: 2px; }

  .form-input,
  .form-textarea,
  .form-select {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14.5px;
    color: var(--ink);
    background: white;
    transition: border-color 0.15s;
    outline: none;
    -webkit-appearance: none;
  }

  .form-input:focus,
  .form-textarea:focus,
  .form-select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(26,76,59,0.08);
  }

  .form-textarea {
    min-height: 90px;
    resize: vertical;
    line-height: 1.6;
  }

  .form-hint {
    font-size: 12.5px;
    color: var(--ink-muted);
    margin-top: 5px;
  }

  .form-grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  /* ── No exception banner ── */
  .no-exception-banner {
    display: none;
    align-items: center;
    gap: 10px;
    background: var(--accent-light);
    border: 1px solid #C8DDD6;
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    margin-top: 20px;
    font-size: 14px;
    color: var(--accent);
    font-weight: 500;
    animation: fadeSlide 0.25s ease;
  }

  .no-exception-banner.visible { display: flex; }
  .no-exception-banner svg { width: 18px; height: 18px; flex-shrink: 0; }

  /* ── Nav buttons ── */
  .nav-buttons {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 48px;
    padding-top: 28px;
    border-top: 1px solid var(--border);
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14.5px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
  }

  .btn-outline {
    background: transparent;
    border: 1.5px solid var(--border);
    color: var(--ink-muted);
  }

  .btn-outline:hover { border-color: var(--ink); color: var(--ink); }

  .btn-primary {
    background: var(--accent);
    color: white;
  }

  .btn-primary:hover { background: #163D2F; }

  .btn svg { width: 16px; height: 16px; }

  /* ── Summary panel ── */
  .summary-intro {
    background: var(--accent);
    color: white;
    border-radius: var(--radius);
    padding: 28px 32px;
    margin-bottom: 32px;
  }

  .summary-intro h3 {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    margin-bottom: 8px;
  }

  .summary-intro p { font-size: 14px; opacity: 0.8; line-height: 1.6; }

  .summary-block {
    background: white;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 16px;
    overflow: hidden;
  }

  .summary-block-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 22px;
    background: #FAFAF8;
    border-bottom: 1px solid var(--border);
  }

  .summary-block-title {
    font-weight: 600;
    font-size: 14px;
    color: var(--ink);
  }

  .summary-tag {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    padding: 3px 10px;
    border-radius: 999px;
  }

  .tag-standard { background: var(--accent-light); color: var(--tag-standard); }
  .tag-exception { background: var(--warning-light); color: var(--tag-exception); }

  .summary-block-body {
    padding: 18px 22px;
  }

  .summary-field {
    margin-bottom: 12px;
  }

  .summary-field:last-child { margin-bottom: 0; }

  .summary-field-label {
    font-size: 11.5px;
    font-weight: 600;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    color: var(--ink-muted);
    margin-bottom: 4px;
  }

  .summary-field-value {
    font-size: 14px;
    color: var(--ink);
    line-height: 1.5;
  }

  .submit-btn {
    width: 100%;
    padding: 16px;
    font-size: 16px;
    border-radius: 10px;
    background: var(--accent);
    color: white;
    border: none;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    cursor: pointer;
    margin-top: 32px;
    transition: background 0.15s;
  }

  .submit-btn:hover { background: #163D2F; }

  /* ── Welcome panel ── */
  .welcome-hero {
    background: var(--ink);
    border-radius: 16px;
    padding: 52px 48px;
    color: white;
    margin-bottom: 40px;
    position: relative;
    overflow: hidden;
  }

  .welcome-hero::before {
    content: '';
    position: absolute;
    top: -60px; right: -60px;
    width: 280px; height: 280px;
    background: radial-gradient(circle, rgba(200,169,110,0.2) 0%, transparent 70%);
  }

  .welcome-eyebrow {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 16px;
  }

  .welcome-title {
    font-family: 'DM Serif Display', serif;
    font-size: 42px;
    letter-spacing: -0.5px;
    line-height: 1.1;
    margin-bottom: 18px;
  }

  .welcome-body {
    font-size: 16px;
    color: rgba(255,255,255,0.7);
    line-height: 1.7;
    max-width: 560px;
    margin-bottom: 32px;
  }

  .welcome-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 40px;
  }

  .welcome-card {
    background: white;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 22px 20px;
  }

  .welcome-card-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
  }

  .welcome-card-icon svg { width: 18px; height: 18px; }
  .icon-green { background: var(--accent-light); color: var(--accent); }
  .icon-amber { background: #FEF3E2; color: #9B6700; }
  .icon-red { background: var(--warning-light); color: var(--warning); }

  .welcome-card h4 {
    font-weight: 600;
    font-size: 14px;
    color: var(--ink);
    margin-bottom: 6px;
  }

  .welcome-card p {
    font-size: 13px;
    color: var(--ink-muted);
    line-height: 1.5;
  }

  /* ── Submitted state ── */
  .submitted-state {
    display: none;
    text-align: center;
    padding: 80px 40px;
  }

  .submitted-state.visible { display: block; }

  .submitted-icon {
    width: 72px;
    height: 72px;
    background: var(--accent-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
  }

  .submitted-icon svg { width: 32px; height: 32px; color: var(--accent); }

  .submitted-state h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 32px;
    margin-bottom: 12px;
  }

  .submitted-state p { font-size: 16px; color: var(--ink-muted); line-height: 1.6; }

  /* ── Export ── */
  .export-row {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    justify-content: center;
  }

  .export-row .btn {
    font-size: 13.5px;
  }


  .autosave-status {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 12px;
    font-size: 11.5px;
    color: rgba(255,255,255,0.45);
    transition: color 0.3s;
  }
  .autosave-status.saving { color: var(--gold); }
  .autosave-status.saved { color: rgba(255,255,255,0.55); }
  .autosave-status svg { width: 12px; height: 12px; flex-shrink: 0; }
  .resume-banner {
    display: none;
    background: var(--gold);
    color: #1C1A17;
    border-radius: var(--radius);
    padding: 16px 20px;
    margin-bottom: 24px;
    font-size: 14px;
    font-weight: 500;
    align-items: center;
    gap: 12px;
  }
  .resume-banner.visible { display: flex; }
  .resume-banner svg { width: 20px; height: 20px; flex-shrink: 0; }
  .resume-banner-text { flex: 1; line-height: 1.4; }
  .resume-banner-text small { display: block; font-weight: 400; font-size: 12px; opacity: 0.7; margin-top: 2px; }
  .resume-dismiss {
    background: rgba(0,0,0,0.15);
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    color: #1C1A17;
    white-space: nowrap;
  }
  .resume-dismiss:hover { background: rgba(0,0,0,0.25); }

  @media (max-width: 900px) {
    .shell { grid-template-columns: 1fr; }
    .sidebar { display: none; }
    .main { padding: 36px 24px; }
    .welcome-cards { grid-template-columns: 1fr; }
    .form-grid-2 { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="shell">

  <!-- ── Sidebar ── -->
  <aside class="sidebar">
    <div class="sidebar-logo">Workplace<br>Deep Dive</div>
    <div class="sidebar-sub">Special Requirements</div>

    <nav class="sidebar-nav">
      <div class="nav-section-label">Process</div>
      <a class="nav-item active" data-section="welcome" onclick="goTo('welcome')">
        <span class="nav-num">✦</span> Overview
      </a>
      <a class="nav-item" data-section="group" onclick="goTo('group')">
        <span class="nav-num" id="n-group">0</span> Group Info
      </a>
      <hr class="nav-divider">
      <div class="nav-section-label">Topics</div>
      <a class="nav-item" data-section="s1" onclick="goTo('s1')">
        <span class="nav-num" id="n-s1">1</span> Paper & Workflow
      </a>
      <a class="nav-item" data-section="s2" onclick="goTo('s2')">
        <span class="nav-num" id="n-s2">2</span> Storage
      </a>
      <a class="nav-item" data-section="s3" onclick="goTo('s3')">
        <span class="nav-num" id="n-s3">3</span> Technology & IT
      </a>
      <a class="nav-item" data-section="s4" onclick="goTo('s4')">
        <span class="nav-num" id="n-s4">4</span> Access & Security
      </a>
      <a class="nav-item" data-section="s5" onclick="goTo('s5')">
        <span class="nav-num" id="n-s5">5</span> Meeting Spaces
      </a>
      <a class="nav-item" data-section="s6" onclick="goTo('s6')">
        <span class="nav-num" id="n-s6">6</span> Visual Management
      </a>
      <a class="nav-item" data-section="s7" onclick="goTo('s7')">
        <span class="nav-num" id="n-s7">7</span> Ergonomics
      </a>
      <a class="nav-item" data-section="s8" onclick="goTo('s8')">
        <span class="nav-num" id="n-s8">8</span> Other Requirements
      </a>
      <hr class="nav-divider">
      <a class="nav-item" data-section="summary" onclick="goTo('summary')">
        <span class="nav-num">→</span> Summary
      </a>
    </nav>

    <div class="sidebar-progress">
      <div class="progress-label" id="progress-label">0 of 9 sections complete</div>
      <div class="progress-bar-track">
        <div class="progress-bar-fill" id="progress-bar"></div>
      </div>
      <div class="autosave-status saved" id="autosave-status">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
        <span id="autosave-text">Progress saved locally</span>
      </div>
    </div>
  </aside>

  <!-- ── Main ── -->
  <main class="main">

    <!-- WELCOME -->
    <div class="section-panel active" id="panel-welcome">
      <div class="resume-banner" id="resume-banner">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <div class="resume-banner-text">
          You have saved progress from a previous session.
          <small id="resume-saved-time">Your answers have been restored.</small>
        </div>
        <button class="resume-dismiss" onclick="clearSavedProgress()">Start fresh</button>
      </div>
      <div class="welcome-hero">
        <div class="welcome-eyebrow">Workplace for Tomorrow</div>
        <div class="welcome-title">Special Requirements<br>Deep Dive</div>
        <div class="welcome-body">This form will guide your team through each workspace topic, show you what the standard solution already provides, and capture only the requirements that are genuinely unique to your team.</div>
        <button class="btn btn-primary" style="background:var(--gold);color:#1C1A17;font-size:15px;padding:14px 30px;" onclick="goTo('group')">
          Get started
          <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
        </button>
      </div>

      <div class="welcome-cards">
        <div class="welcome-card">
          <div class="welcome-card-icon icon-green">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <h4>Learn the standard first</h4>
          <p>Each topic begins with what's already planned — so you know what you're getting by default.</p>
        </div>
        <div class="welcome-card">
          <div class="welcome-card-icon icon-amber">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <h4>Only flag true exceptions</h4>
          <p>We ask you one simple question per topic: does the standard meet your needs? Only describe your needs if it doesn't.</p>
        </div>
        <div class="welcome-card">
          <div class="welcome-card-icon icon-red">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          </div>
          <h4>Auto-collated output</h4>
          <p>Your answers compile into a summary report that the project team can review directly — no manual synthesis needed.</p>
        </div>
      </div>

      <div style="background:white;border:1px solid var(--border);border-radius:var(--radius);padding:24px 28px;">
        <p style="font-size:14px;color:var(--ink-muted);line-height:1.7;"><strong style="color:var(--ink);">Who should complete this?</strong> One representative per team or department, ideally someone who can speak to how your team actually works day-to-day. If you have questions, contact your workplace project coordinator before completing. This typically takes 15–25 minutes. <strong style="color:var(--ink);">Only fill in exception fields where the standard genuinely doesn't work for you.</strong> If you leave exception sections blank, that tells us the standard is fine.</p>
      </div>
    </div>

    <!-- GROUP INFO -->
    <div class="section-panel" id="panel-group">
      <div class="panel-header">
        <div class="panel-tag">Start here</div>
        <h1 class="panel-title">About your team</h1>
        <p class="panel-description">Tell us a bit about who you represent. This context helps the project team understand the scale and nature of any requirements you flag.</p>
      </div>

      <div class="form-group">
        <label class="form-label">Department / team name(s) <span class="required">*</span></label>
        <input type="text" class="form-input" id="g-dept" placeholder="e.g. Risk & Compliance, Payor Strategy" oninput="autosave()">
      </div>

      <div class="form-group">
        <label class="form-label">Brief description of your team's role and responsibilities <span class="required">*</span></label>
        <textarea class="form-textarea" id="g-role" placeholder="What does your team do? What does a typical workday look like?" oninput="autosave()"></textarea>
      </div>

      <div class="form-grid-2">
        <div class="form-group">
          <label class="form-label">Current primary location(s)</label>
          <input type="text" class="form-input" id="g-location" placeholder="e.g. 777 3rd Ave, Floor 12" oninput="autosave()">
        </div>
        <div class="form-group">
          <label class="form-label">Approximate headcount</label>
          <input type="number" class="form-input" id="g-headcount" placeholder="e.g. 42" min="1" oninput="autosave()">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Current workspace setup</label>
        <textarea class="form-textarea" style="min-height:72px;" id="g-setup" placeholder="e.g. 30 dedicated desks, 2 private offices, 1 dedicated meeting room. Occasionally use shared conference rooms on floor 14." oninput="autosave()"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">Rough time split between assigned space and other locations</label>
        <input type="text" class="form-input" id="g-split" placeholder="e.g. ~70% at desk, 20% in meetings, 10% offsite / remote" oninput="autosave()">
      </div>

      <div class="form-group">
        <label class="form-label">Number of team members without HSS-issued laptops (or who remote in to a desktop)</label>
        <input type="number" class="form-input" id="g-nolaptop" placeholder="e.g. 4" min="0" oninput="autosave()">
        <div class="form-hint">Include anyone who currently relies on a fixed desktop workstation to do their job.</div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('welcome')">
          <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/></svg>
          Back
        </button>
        <button class="btn btn-primary" onclick="completeSection('group'); goTo('s1')">
          Continue <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
        </button>
      </div>
    </div>

    <!-- TOPIC 1: PAPER -->
    <div class="section-panel" id="panel-s1">
      <div class="panel-header">
        <div class="panel-tag">Topic 1 of 8</div>
        <h1 class="panel-title">Paper & workflow processes</h1>
        <p class="panel-description">Paper-based workflows — receiving, processing, annotating, or sending physical documents — are a common area of concern during office transitions.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon" style="background:var(--accent);">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li>Reduction in paper reliance — digital workflows replace paper-based signing, filing, and distribution wherever feasible</li>
          <li><strong>Follow-me / pull printing</strong>: Documents print only when you authenticate at a printer. Your document follows you to any printer on the floor.</li>
          <li>Mail distributed on a team basis, or scanned and routed digitally</li>
          <li>Hard-copy-only documents stored off-site (e.g. Iron Mountain) if not needed on-site daily</li>
          <li>Shared team printer/scanner on every floor, not at individual desks</li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard solution above cover your team's paper and workflow needs?</div>
        <div class="gate-hint">Select "Yes, covered" if you don't have unusual paper processes. Only select "No, we have exceptions" if your team has requirements the standard doesn't address.</div>
        <div class="gate-options">
          <button class="gate-btn" id="s1-yes" onclick="setGate('s1', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s1-no" onclick="setGate('s1', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s1-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s1-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Please only describe what the standard <em>doesn't</em> cover. Avoid repeating what's already listed above.
          </div>
          <div class="form-group">
            <label class="form-label">Describe the specific paper or workflow exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s1-desc" placeholder="e.g. We receive ~200 original-signature invoices per week that must be physically signed, stamped, and filed on-site per regulatory requirement. These cannot be digitised at this stage." oninput="autosave()"></textarea>
          </div>
          <div class="form-grid-2">
            <div class="form-group">
              <label class="form-label">Approximate volume / frequency</label>
              <input type="text" class="form-input" id="s1-vol" placeholder="e.g. ~50 documents/week" oninput="autosave()">
            </div>
            <div class="form-group">
              <label class="form-label">Number of people affected</label>
              <input type="number" class="form-input" id="s1-people" placeholder="e.g. 3" min="1" oninput="autosave()">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">What space or equipment would this require?</label>
            <textarea class="form-textarea" style="min-height:72px;" id="s1-space" placeholder="e.g. A dedicated secure filing area adjacent to the team zone, approximately 2m of lateral filing." oninput="autosave()"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Is this a regulatory / compliance requirement, or an operational preference?</label>
            <select class="form-select" id="s1-driver" onchange="autosave()">
              <option value="">— Select one —</option>
              <option>Regulatory / legal requirement</option>
              <option>Clinical or safety requirement</option>
              <option>Operational need (not regulated)</option>
              <option>Team preference / habit</option>
              <option>Unsure</option>
            </select>
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('group')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s1'); goTo('s2')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 2: STORAGE -->
    <div class="section-panel" id="panel-s2">
      <div class="panel-header">
        <div class="panel-tag">Topic 2 of 8</div>
        <h1 class="panel-title">Storage needs</h1>
        <p class="panel-description">Moving to a shared environment means a shift away from individual storage. Here's what's already built into the plan.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg></div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li><strong>Day lockers</strong> for personal items (bag, laptop, personal belongings) — available to every employee and visitor on-site</li>
          <li><strong>Team filing cabinets</strong> (individually locking laterals) allocated on an as-needed basis</li>
          <li><strong>Reference shelving</strong> (library-style bookshelves) in shared areas</li>
          <li><strong>Non-workflow storage room</strong> on every floor for infrequently accessed items (statutory documents, marketing collateral, stationery, seasonal items)</li>
          <li>Long-term archiving off-site (e.g. Iron Mountain) where items don't need to be accessed day-to-day</li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard storage provision cover your team's needs?</div>
        <div class="gate-hint">Flag exceptions only if your team has storage requirements that go clearly beyond the standard — e.g. specialised equipment, secure clinical documentation, high-volume regulated archives.</div>
        <div class="gate-options">
          <button class="gate-btn" id="s2-yes" onclick="setGate('s2', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s2-no" onclick="setGate('s2', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s2-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s2-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Please describe only what goes beyond the standard listed above.
          </div>
          <div class="form-group">
            <label class="form-label">Describe the storage exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s2-desc" placeholder="e.g. We hold 8 lateral drawers of active clinical trial source documents that must be on-site, secure, and accessible to auditors within 15 minutes of request." oninput="autosave()"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Storage type(s) required</label>
            <input type="text" class="form-input" id="s2-type" placeholder="e.g. Lateral filing cabinets, enclosed secure room, refrigerated storage, oversized flat-file drawers" oninput="autosave()">
          </div>
          <div class="form-grid-2">
            <div class="form-group">
              <label class="form-label">Approximate volume (linear metres, number of drawers, etc.)</label>
              <input type="text" class="form-input" id="s2-vol" placeholder="e.g. 6 lateral drawers, ~4 lin. metres" oninput="autosave()">
            </div>
            <div class="form-group">
              <label class="form-label">Access frequency</label>
              <select class="form-select" id="s2-freq" onchange="autosave()">
                <option value="">— Select —</option>
                <option>Multiple times daily</option>
                <option>Daily</option>
                <option>A few times per week</option>
                <option>Monthly or less</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Security / access control requirements</label>
            <input type="text" class="form-input" id="s2-security" placeholder="e.g. Must be in an enclosed, locked room; key-card access only; audit trail required" oninput="autosave()">
          </div>
          <div class="form-group">
            <label class="form-label">Driver of this requirement</label>
            <select class="form-select" id="s2-driver" onchange="autosave()">
              <option value="">— Select one —</option>
              <option>Regulatory / legal requirement</option>
              <option>Clinical or safety requirement</option>
              <option>Operational need (not regulated)</option>
              <option>Team preference / habit</option>
              <option>Unsure</option>
            </select>
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s1')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s2'); goTo('s3')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 3: TECHNOLOGY -->
    <div class="section-panel" id="panel-s3">
      <div class="panel-header">
        <div class="panel-tag">Topic 3 of 8</div>
        <h1 class="panel-title">Technology & IT kit</h1>
        <p class="panel-description">IT equipment is largely standardised across the organisation. Please flag only genuine exceptions — e.g. specialist hardware, non-standard monitor requirements, or call-intensive roles.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li><strong>HSS-issued laptop</strong> as primary computing device</li>
          <li><strong>Universal docking station</strong> at every workstation — connects laptop to screens, keyboard, mouse; charges USB devices</li>
          <li><strong>1–2 monitors</strong> per workstation</li>
          <li><strong>Peripherals</strong>: 1 keyboard, 1 mouse, personal headset (for calls and virtual meetings)</li>
          <li><strong>Softphone</strong>: make/receive calls from a landline number via PC or smartphone — no desk phone needed at standard workstations</li>
          <li>Desk phones available in call-centre zones or solo booths for high-call-volume roles</li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard IT kit cover your team's technology needs?</div>
        <div class="gate-hint">Note: If members of your team currently remote-in to a desktop or don't have a laptop, you already told us this in Group Info — that's captured. Flag here only if there's additional specialised equipment needed.</div>
        <div class="gate-options">
          <button class="gate-btn" id="s3-yes" onclick="setGate('s3', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s3-no" onclick="setGate('s3', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s3-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s3-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Describe only requirements beyond the standard — specialist hardware, unusual monitor needs, dedicated desk phone lines, etc.
          </div>
          <div class="form-group">
            <label class="form-label">Describe the technology exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s3-desc" placeholder="e.g. 3 team members use dual 27&quot; monitors and a drawing tablet for radiology image review. Standard 1-2 screen setup is insufficient for this workflow." oninput="autosave()"></textarea>
          </div>
          <div class="form-grid-2">
            <div class="form-group">
              <label class="form-label">Number of people affected</label>
              <input type="number" class="form-input" id="s3-people" placeholder="e.g. 3" min="1" oninput="autosave()">
            </div>
            <div class="form-group">
              <label class="form-label">Driver</label>
              <select class="form-select" id="s3-driver" onchange="autosave()">
                <option value="">— Select one —</option>
                <option>Regulatory / clinical requirement</option>
                <option>Software / system dependency</option>
                <option>High call volume / telephony need</option>
                <option>Specialist hardware (e.g. drawing tablet, dual high-res monitors)</option>
                <option>Other operational need</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Any IT contacts or existing approvals for this equipment?</label>
            <input type="text" class="form-input" id="s3-it" placeholder="e.g. Already approved by IT — contact Jane Smith. Or: needs IT review." oninput="autosave()">
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s2')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s3'); goTo('s4')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 4: ACCESS / SECURITY -->
    <div class="section-panel" id="panel-s4">
      <div class="panel-header">
        <div class="panel-tag">Topic 4 of 8</div>
        <h1 class="panel-title">Access, confidentiality & security</h1>
        <p class="panel-description">Many confidentiality needs are already covered by the design. Read carefully before flagging an exception.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li>Badge-controlled access at building entry and floor level — restricts entry beyond the lobby</li>
          <li>Every employee has access to workspaces with <strong>acoustic privacy</strong> (phone booths, enclosed meeting rooms) for sensitive conversations</li>
          <li>Every employee has access to <strong>visual privacy</strong> options (privacy screen filters, enclosed booths)</li>
          <li>Meeting rooms provide full acoustic and configurable visual privacy</li>
          <li>Training available to help staff make good choices about where to have confidential conversations</li>
          <li><em>Note: Individual health/disability accommodations are managed separately through Employee Health — please do not include these here.</em></li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard security and confidentiality provision cover your team's needs?</div>
        <div class="gate-hint">Think about: specific data classification requirements, regulatory constraints on adjacency, or physical security needs beyond badge access (e.g. secure server room access, visitor restrictions).</div>
        <div class="gate-options">
          <button class="gate-btn" id="s4-yes" onclick="setGate('s4', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s4-no" onclick="setGate('s4', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s4-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s4-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Describe only what the standard cannot address. Be specific about whether the need is acoustic, visual, physical, digital, or an adjacency restriction.
          </div>
          <div class="form-group">
            <label class="form-label">Describe the security or access exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s4-desc" placeholder="e.g. Our team handles M&A due diligence. We need a dedicated, always-locked area where screens cannot be viewed from adjacent workstations or corridors — standard privacy screens are not sufficient." oninput="autosave()"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Type of privacy / security need</label>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:4px;" id="s4-type-group">
              <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><input type="checkbox" value="acoustic" onchange="autosave()"> Acoustic (can't be overheard)</label>
              <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><input type="checkbox" value="visual" onchange="autosave()"> Visual (screen content)</label>
              <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><input type="checkbox" value="physical" onchange="autosave()"> Physical (restricted area)</label>
              <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><input type="checkbox" value="adjacency" onchange="autosave()"> Adjacency restriction</label>
              <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><input type="checkbox" value="digital" onchange="autosave()"> Digital / data compliance</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Regulatory or compliance basis (if applicable)</label>
            <input type="text" class="form-input" id="s4-reg" placeholder="e.g. HIPAA, SEC information barrier requirements, attorney-client privilege, SOX" oninput="autosave()">
          </div>
          <div class="form-group">
            <label class="form-label">Are there any teams you must be separated from or cannot be adjacent to?</label>
            <input type="text" class="form-input" id="s4-adj" placeholder="e.g. Must not be co-located with Trading desk due to information barrier" oninput="autosave()">
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s3')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s4'); goTo('s5')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 5: MEETING SPACES -->
    <div class="section-panel" id="panel-s5">
      <div class="panel-header">
        <div class="panel-tag">Topic 5 of 8</div>
        <h1 class="panel-title">Meeting spaces</h1>
        <p class="panel-description">A range of meeting environments is already planned. Please flag only requirements that go beyond the standard provision.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li><strong>Meeting rooms (6–10 people)</strong>: Acoustically private, AV-enabled for display and video conferencing, for structured meetings of 1–2 hours</li>
          <li><strong>Huddle rooms (2–5 people)</strong>: Semi-private, AV-capable, suited to quick discussions and hybrid calls</li>
          <li><strong>Soft / open settings</strong>: Informal collaboration areas for small groups, solo focus work, and social interaction — variety of sizes</li>
          <li>All bookable meeting rooms equipped for hybrid participation (screen, camera, microphone)</li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard meeting space provision cover your team's needs?</div>
        <div class="gate-hint">Consider: specialist rooms (e.g. training rooms for >10 people, presentation theatres, rooms requiring specific AV beyond standard), dedicated team rooms used many hours per day, or clinical spaces.</div>
        <div class="gate-options">
          <button class="gate-btn" id="s5-yes" onclick="setGate('s5', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s5-no" onclick="setGate('s5', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s5-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s5-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Describe only requirements that the standard meeting rooms and huddle rooms don't address.
          </div>
          <div class="form-group">
            <label class="form-label">Describe the meeting space exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s5-desc" placeholder="e.g. We run monthly all-hands training sessions for 30–40 staff requiring a presentation-style room with a projector, lectern, and moveable chairs. This isn't available in the standard 10-person meeting room." oninput="autosave()"></textarea>
          </div>
          <div class="form-grid-2">
            <div class="form-group">
              <label class="form-label">Capacity needed</label>
              <input type="text" class="form-input" id="s5-cap" placeholder="e.g. 30–40 people" oninput="autosave()">
            </div>
            <div class="form-group">
              <label class="form-label">Frequency of use</label>
              <input type="text" class="form-input" id="s5-freq" placeholder="e.g. Monthly, ~3 hrs each time" oninput="autosave()">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Special AV or furniture requirements</label>
            <input type="text" class="form-input" id="s5-av" placeholder="e.g. Projection screen, dual displays, moveable seating, soundproofing, clinical-grade surfaces" oninput="autosave()">
          </div>
          <div class="form-group">
            <label class="form-label">Must this space be dedicated / reserved to your team, or can it be shared?</label>
            <select class="form-select" id="s5-ded" onchange="autosave()">
              <option value="">— Select —</option>
              <option>Must be dedicated to our team</option>
              <option>Bookable (shared) is fine</option>
              <option>Either works — depends on design</option>
            </select>
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s4')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s5'); goTo('s6')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 6: VISUAL MANAGEMENT -->
    <div class="section-panel" id="panel-s6">
      <div class="panel-header">
        <div class="panel-tag">Topic 6 of 8</div>
        <h1 class="panel-title">Visual management</h1>
        <p class="panel-description">Kanban boards, performance dashboards, Agile walls — if your team runs regular visual management processes, this is the place to describe them.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li>Whiteboards available in open work areas for all staff to use</li>
          <li>Large meeting rooms (6+ seats) equipped with writable wall surfaces for visualisation</li>
          <li>Standard assumption: visual management sessions are in-person only — no hybrid camera/mic setup required unless specifically requested</li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard visual management provision cover your team's needs?</div>
        <div class="gate-hint">Flag an exception if you need: a permanently dedicated wall or board (not shareable), very large physical display areas, a specific location adjacent to your team zone, or real-time hybrid visual management capability.</div>
        <div class="gate-options">
          <button class="gate-btn" id="s6-yes" onclick="setGate('s6', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s6-no" onclick="setGate('s6', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s6-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s6-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Describe only what the standard whiteboards and writable walls don't cover for your team.
          </div>
          <div class="form-group">
            <label class="form-label">Describe the visual management exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s6-desc" placeholder="e.g. We run a daily stand-up at a 4m Agile board that must remain permanently set up and visible to the full team. A shared whiteboard that gets erased between uses won't work for us." oninput="autosave()"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Approximate size / area required</label>
            <input type="text" class="form-input" id="s6-size" placeholder="e.g. 4m of wall space; permanent pinboard area" oninput="autosave()">
          </div>
          <div class="form-group">
            <label class="form-label">Frequency of use</label>
            <input type="text" class="form-input" id="s6-freq" placeholder="e.g. Daily 15-min stand-ups + weekly sprint reviews" oninput="autosave()">
          </div>
          <div class="form-group">
            <label class="form-label">Does this need to support hybrid participants (remote attendees)?</label>
            <select class="form-select" id="s6-hybrid" onchange="autosave()">
              <option value="">— Select —</option>
              <option>Yes — camera + screen needed</option>
              <option>No — in-person only</option>
              <option>Occasionally — nice to have</option>
            </select>
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s5')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s6'); goTo('s7')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 7: ERGONOMICS -->
    <div class="section-panel" id="panel-s7">
      <div class="panel-header">
        <div class="panel-tag">Topic 7 of 8</div>
        <h1 class="panel-title">Ergonomics & accessibility</h1>
        <p class="panel-description">The new environment is designed to a higher ergonomics standard than most existing workplaces. Individual health-related accommodations should go through Employee Health, not this form.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
          <div class="standard-card-title">What the standard solution already includes</div>
        </div>
        <ul class="standard-bullets">
          <li>All standard workstations are <strong>sit-to-stand height-adjustable</strong></li>
          <li>Task chairs with full adjustability: arms, lumbar support, rolling casters, adjustable seat height — capable of 8-hour support</li>
          <li>Designed to <strong>exceed wheelchair accessibility standards</strong> throughout</li>
          <li>Choice of environments means individuals can self-select brighter or dimmer areas, quieter or more energetic zones</li>
          <li>Individual health/disability accommodations continue to be managed through Employee Health privately — <em>do not include personal health details here</em></li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does the standard ergonomic design cover your team's group-level needs?</div>
        <div class="gate-hint">Flag here only if your team has a functional (not personal health) requirement — e.g. a specialist workstation configuration required by your role, not by an individual's medical need.</div>
        <div class="gate-options">
          <button class="gate-btn" id="s7-yes" onclick="setGate('s7', 'yes')">✓ Yes, covered by standard</button>
          <button class="gate-btn" id="s7-no" onclick="setGate('s7', 'no')">✗ No, we have exceptions</button>
        </div>
        <div class="no-exception-banner" id="s7-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — no exception needed. The standard applies to your team.
        </div>
        <div class="exception-form" id="s7-form">
          <div class="exception-alert">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            Do not include personal health information. Describe only functional, role-level needs (e.g. equipment used for a specific job task, not a medical accommodation).
          </div>
          <div class="form-group">
            <label class="form-label">Describe the ergonomic or accessibility exception <span class="required">*</span></label>
            <textarea class="form-textarea" id="s7-desc" placeholder="e.g. Staff in our imaging review role spend 6+ hours reviewing high-resolution scans and require a monitor arm rated for 34&quot; curved monitors — standard desk mounts won't support this." oninput="autosave()"></textarea>
          </div>
          <div class="form-grid-2">
            <div class="form-group">
              <label class="form-label">Number of people affected</label>
              <input type="number" class="form-input" id="s7-people" placeholder="e.g. 5" min="1" oninput="autosave()">
            </div>
            <div class="form-group">
              <label class="form-label">Is this a role-specific need, not an individual health need?</label>
              <select class="form-select" id="s7-confirm" onchange="autosave()">
                <option value="">— Select —</option>
                <option>Yes — this is a role/functional requirement</option>
                <option>Unsure — may need review</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s6')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s7'); goTo('s8')">Continue →</button>
      </div>
    </div>

    <!-- TOPIC 8: OTHER -->
    <div class="section-panel" id="panel-s8">
      <div class="panel-header">
        <div class="panel-tag">Topic 8 of 8</div>
        <h1 class="panel-title">Any other specific requirements</h1>
        <p class="panel-description">Is there anything else about your team's functional needs that doesn't fit under the categories above? This is your opportunity to flag it.</p>
      </div>

      <div class="standard-card">
        <div class="standard-card-header">
          <div class="standard-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div>
          <div class="standard-card-title">Things to consider before adding an "other" requirement</div>
        </div>
        <ul class="standard-bullets">
          <li>Is the need covered by any of the 7 topics above? If so, please go back and add it there.</li>
          <li>Is it a personal preference rather than a functional requirement? Preferences are noted but may not be actioned.</li>
          <li>Does it relate to an individual health accommodation? If so, please use Employee Health instead.</li>
          <li>Functional requirements are things directly tied to <em>how your team executes its work</em> — not comfort preferences or aesthetic choices.</li>
        </ul>
      </div>

      <div class="exception-gate">
        <div class="gate-question">Does your team have any functional requirements not covered by the 7 topics above?</div>
        <div class="gate-options">
          <button class="gate-btn" id="s8-yes" onclick="setGate('s8', 'yes')">✓ Yes, we have other requirements</button>
          <button class="gate-btn" id="s8-no" onclick="setGate('s8', 'no')">✗ No, all covered above</button>
        </div>
        <div class="no-exception-banner" id="s8-noexception">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Great — nothing additional to flag.
        </div>
        <div class="exception-form" id="s8-form">
          <div class="form-group">
            <label class="form-label">Describe the additional requirement <span class="required">*</span></label>
            <textarea class="form-textarea" id="s8-desc" placeholder="e.g. Our team receives live specimen deliveries from the operating theatre that must be processed within 30 minutes. We need a dedicated wet lab bench with cold storage adjacent to our workspace — this is a clinical safety requirement." oninput="autosave()"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Driver of this requirement</label>
            <select class="form-select" id="s8-driver" onchange="autosave()">
              <option value="">— Select one —</option>
              <option>Regulatory / legal requirement</option>
              <option>Clinical or safety requirement</option>
              <option>Operational need (not regulated)</option>
              <option>Team preference</option>
              <option>Unsure</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Number of people affected</label>
            <input type="number" class="form-input" id="s8-people" placeholder="e.g. 8" min="1" oninput="autosave()">
          </div>
        </div>
      </div>

      <div class="nav-buttons">
        <button class="btn btn-outline" onclick="goTo('s7')">← Back</button>
        <button class="btn btn-primary" onclick="completeSection('s8'); goTo('summary')">Review summary →</button>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="section-panel" id="panel-summary">
      <div class="panel-header">
        <div class="panel-tag">Final step</div>
        <h1 class="panel-title">Your submission summary</h1>
        <p class="panel-description">Review your responses below. Only topics where you flagged an exception will be sent to the project team for review. Topics marked "standard" require no further action.</p>
      </div>

      <div id="summary-content"></div>

      <button class="submit-btn" onclick="submitForm()">
        Submit to project team →
      </button>

      <div class="export-row">
        <button class="btn btn-outline" onclick="exportText()">
          <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/></svg>
          Download as text
        </button>
        <button class="btn btn-outline" onclick="window.print()">
          <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"/></svg>
          Print / save as PDF
        </button>
      </div>

      <div class="nav-buttons" style="border-top:none;margin-top:16px;">
        <button class="btn btn-outline" onclick="goTo('s8')">← Back to edit</button>
      </div>
    </div>

    <!-- SUBMITTED -->
    <div class="submitted-state" id="submitted">
      <div class="submitted-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      </div>
      <h2>Submitted — thank you.</h2>
      <p>Your responses have been compiled and are ready for the project team.<br>You'll hear back if any of your flagged exceptions need further discussion.</p>
      <div class="export-row" style="margin-top:32px;">
        <button class="btn btn-outline" onclick="exportText()">Download your summary</button>
        <button class="btn btn-outline" onclick="window.print()">Print / save as PDF</button>
      </div>
    </div>

  </main>
</div>

<script>
// ── State ──
const state = {
  completed: new Set(),
  gates: {}, // s1-s8: 'yes'|'no'
};

const SECTIONS = ['welcome','group','s1','s2','s3','s4','s5','s6','s7','s8','summary'];
const TOPIC_LABELS = {
  s1: '1. Paper & workflow',
  s2: '2. Storage',
  s3: '3. Technology & IT kit',
  s4: '4. Access & security',
  s5: '5. Meeting spaces',
  s6: '6. Visual management',
  s7: '7. Ergonomics & accessibility',
  s8: '8. Other requirements',
};

let currentSection = 'welcome';

function goTo(section) {
  document.getElementById('panel-' + currentSection)?.classList.remove('active');
  document.getElementById('panel-' + section)?.classList.add('active');
  currentSection = section;

  // Update sidebar active
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.querySelector(`[data-section="${section}"]`)?.classList.add('active');

  if (section === 'summary') buildSummary();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function setGate(topic, val) {
  state.gates[topic] = val;
  const yesBtn = document.getElementById(topic + '-yes');
  const noBtn = document.getElementById(topic + '-no');
  const form = document.getElementById(topic + '-form');
  const noEx = document.getElementById(topic + '-noexception');

  yesBtn.className = 'gate-btn' + (val === 'yes' ? ' selected-no' : '');
  noBtn.className = 'gate-btn' + (val === 'no' ? ' selected-yes' : '');

  if (val === 'no') {
    form.classList.add('visible');
    noEx.classList.remove('visible');
  } else {
    form.classList.remove('visible');
    noEx.classList.add('visible');
  }

  updateSidebarNum(topic);
}

function updateSidebarNum(topic) {
  const num = document.getElementById('n-' + topic);
  if (!num) return;
  const gate = state.gates[topic];
  if (gate === 'yes') { num.textContent = '✓'; num.style.background = 'rgba(200,169,110,0.8)'; }
  else if (gate === 'no') { num.textContent = '!'; num.style.background = '#B85042'; }
  else { num.textContent = topic.replace('s',''); num.style.background = ''; }
}

function completeSection(section) {
  state.completed.add(section);
  updateProgress();
  if (section !== 'group') updateSidebarNum(section);
  if (section === 'group') {
    const gNum = document.getElementById('n-group');
    if (gNum) { gNum.textContent = '✓'; gNum.style.background = 'rgba(200,169,110,0.8)'; }
  }
}

function updateProgress() {
  const total = 9; // group + 8 topics
  const done = state.completed.size;
  const pct = Math.round((done / total) * 100);
  document.getElementById('progress-bar').style.width = pct + '%';
  document.getElementById('progress-label').textContent = `${done} of ${total} sections complete`;
}

const ALL_FIELDS = [
  'g-dept','g-role','g-location','g-headcount','g-setup','g-split','g-nolaptop',
  's1-desc','s1-vol','s1-people','s1-space','s1-driver',
  's2-desc','s2-type','s2-vol','s2-freq','s2-security','s2-driver',
  's3-desc','s3-people','s3-driver','s3-it',
  's4-desc','s4-reg','s4-adj',
  's5-desc','s5-cap','s5-freq','s5-av','s5-ded',
  's6-desc','s6-size','s6-freq','s6-hybrid',
  's7-desc','s7-people','s7-confirm',
  's8-desc','s8-driver','s8-people'
];
const STORAGE_KEY = 'wft_special_req_v1';
let autosaveTimer = null;

function autosave() {
  const status = document.getElementById('autosave-status');
  const text = document.getElementById('autosave-text');
  if (status) { status.className = 'autosave-status saving'; text.textContent = 'Saving...'; }
  clearTimeout(autosaveTimer);
  autosaveTimer = setTimeout(() => {
    const data = { savedAt: new Date().toISOString(), fields: {}, gates: { ...state.gates }, completed: [...state.completed] };
    ALL_FIELDS.forEach(id => { const el = document.getElementById(id); if (el) data.fields[id] = el.value; });
    data.s4_checkboxes = [...document.querySelectorAll('#s4-type-group input')].map(el => el.checked);
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch(e) {}
    if (status) { status.className = 'autosave-status saved'; text.textContent = 'Progress saved'; }
  }, 800);
}

function restoreProgress() {
  let saved;
  try { saved = JSON.parse(localStorage.getItem(STORAGE_KEY)); } catch(e) { return; }
  if (!saved) return;
  ALL_FIELDS.forEach(id => { const el = document.getElementById(id); if (el && saved.fields && saved.fields[id] !== undefined) el.value = saved.fields[id]; });
  if (saved.s4_checkboxes) {
    const boxes = document.querySelectorAll('#s4-type-group input');
    boxes.forEach((el, i) => { if (saved.s4_checkboxes[i] !== undefined) el.checked = saved.s4_checkboxes[i]; });
  }
  if (saved.gates) { Object.entries(saved.gates).forEach(([t, v]) => setGate(t, v)); }
  if (saved.completed) {
    saved.completed.forEach(s => {
      state.completed.add(s);
      if (s === 'group') { const n = document.getElementById('n-group'); if (n) { n.textContent = '\u2713'; n.style.background = 'rgba(200,169,110,0.8)'; } }
      else updateSidebarNum(s);
    });
    updateProgress();
  }
  const banner = document.getElementById('resume-banner');
  if (banner && saved.savedAt) {
    const d = new Date(saved.savedAt);
    const friendly = d.toLocaleDateString(undefined, {weekday:'short',month:'short',day:'numeric'}) + ' at ' + d.toLocaleTimeString(undefined, {hour:'2-digit',minute:'2-digit'});
    const timeEl = document.getElementById('resume-saved-time');
    if (timeEl) timeEl.textContent = 'Last saved: ' + friendly;
    banner.classList.add('visible');
  }
  const t = document.getElementById('autosave-text');
  if (t) t.textContent = 'Progress restored';
}

function clearSavedProgress() {
  try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
  document.getElementById('resume-banner')?.classList.remove('visible');
  ALL_FIELDS.forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
  document.querySelectorAll('#s4-type-group input').forEach(el => el.checked = false);
  ['s1','s2','s3','s4','s5','s6','s7','s8'].forEach(t => {
    delete state.gates[t];
    document.getElementById(t+'-yes')?.setAttribute('class','gate-btn');
    document.getElementById(t+'-no')?.setAttribute('class','gate-btn');
    document.getElementById(t+'-form')?.classList.remove('visible');
    document.getElementById(t+'-noexception')?.classList.remove('visible');
    const num = document.getElementById('n-'+t);
    if (num) { num.textContent = t.replace('s',''); num.style.background = ''; }
  });
  state.completed.clear();
  updateProgress();
  const gNum = document.getElementById('n-group');
  if (gNum) { gNum.textContent = '0'; gNum.style.background = ''; }
  const st = document.getElementById('autosave-text');
  if (st) st.textContent = 'Progress cleared';
}

function clearAfterSubmit() { try { localStorage.removeItem(STORAGE_KEY); } catch(e) {} }

document.addEventListener('DOMContentLoaded', restoreProgress);

function val(id) {
  const el = document.getElementById(id);
  if (!el) return '';
  return el.value?.trim() || '';
}

function buildSummary() {
  const topics = ['s1','s2','s3','s4','s5','s6','s7','s8'];
  let html = `
    <div class="summary-intro">
      <h3>${val('g-dept') || 'Your team'}</h3>
      <p>${val('g-role') || ''} · ${val('g-headcount') || '—'} people · ${val('g-location') || '—'}</p>
    </div>
  `;

  // Group info block
  html += `<div class="summary-block">
    <div class="summary-block-header">
      <div class="summary-block-title">Group information</div>
      <span class="summary-tag tag-standard">Completed</span>
    </div>
    <div class="summary-block-body">
      ${summaryField('Department', val('g-dept'))}
      ${summaryField('Role description', val('g-role'))}
      ${summaryField('Location', val('g-location'))}
      ${summaryField('Headcount', val('g-headcount'))}
      ${summaryField('Current setup', val('g-setup'))}
      ${summaryField('Time split', val('g-split'))}
      ${summaryField('Staff without laptops', val('g-nolaptop'))}
    </div>
  </div>`;

  topics.forEach(t => {
    const gate = state.gates[t];
    const label = TOPIC_LABELS[t];
    if (gate === 'yes' || !gate) {
      html += `<div class="summary-block">
        <div class="summary-block-header">
          <div class="summary-block-title">${label}</div>
          <span class="summary-tag tag-standard">${gate === 'yes' ? 'Standard applies' : 'Not yet answered'}</span>
        </div>
      </div>`;
    } else {
      // Build exception fields per topic
      html += `<div class="summary-block">
        <div class="summary-block-header">
          <div class="summary-block-title">${label}</div>
          <span class="summary-tag tag-exception">Exception flagged</span>
        </div>
        <div class="summary-block-body">
          ${buildExceptionSummary(t)}
        </div>
      </div>`;
    }
  });

  document.getElementById('summary-content').innerHTML = html;
}

function buildExceptionSummary(t) {
  const maps = {
    s1: [['Description', `${t}-desc`], ['Volume / frequency', `${t}-vol`], ['People affected', `${t}-people`], ['Space / equipment needed', `${t}-space`], ['Driver', `${t}-driver`]],
    s2: [['Description', `${t}-desc`], ['Storage type', `${t}-type`], ['Volume', `${t}-vol`], ['Access frequency', `${t}-freq`], ['Security requirements', `${t}-security`], ['Driver', `${t}-driver`]],
    s3: [['Description', `${t}-desc`], ['People affected', `${t}-people`], ['Driver', `${t}-driver`], ['IT contacts / approvals', `${t}-it`]],
    s4: [['Description', `${t}-desc`], ['Regulatory basis', `${t}-reg`], ['Adjacency restrictions', `${t}-adj`]],
    s5: [['Description', `${t}-desc`], ['Capacity needed', `${t}-cap`], ['Frequency', `${t}-freq`], ['AV / furniture', `${t}-av`], ['Dedicated or shared?', `${t}-ded`]],
    s6: [['Description', `${t}-desc`], ['Size required', `${t}-size`], ['Frequency', `${t}-freq`], ['Hybrid needed?', `${t}-hybrid`]],
    s7: [['Description', `${t}-desc`], ['People affected', `${t}-people`], ['Role-level (not health)?', `${t}-confirm`]],
    s8: [['Description', `${t}-desc`], ['Driver', `${t}-driver`], ['People affected', `${t}-people`]],
  };

  // Get security type checkboxes for s4
  if (t === 's4') {
    const checked = [...document.querySelectorAll('#s4-type-group input:checked')].map(el => el.value).join(', ');
    if (checked) maps.s4.splice(1, 0, ['Privacy type(s)', { value: checked }]);
  }

  return (maps[t] || []).map(([label, idOrObj]) => {
    const v = typeof idOrObj === 'string' ? val(idOrObj) : idOrObj.value;
    return summaryField(label, v);
  }).join('');
}

function summaryField(label, value) {
  if (!value) return '';
  return `<div class="summary-field">
    <div class="summary-field-label">${label}</div>
    <div class="summary-field-value">${value}</div>
  </div>`;
}

async function submitForm() {
  const btn = document.querySelector('.submit-btn');
  btn.textContent = 'Submitting…';
  btn.disabled = true;

  const payload = {
    submitted_at: new Date().toISOString(),
    dept:      val('g-dept'),
    role:      val('g-role'),
    location:  val('g-location'),
    headcount: val('g-headcount'),
    setup:     val('g-setup'),
    split:     val('g-split'),
    nolaptop:  val('g-nolaptop'),
    s1_gate:   state.gates['s1'] || 'not answered',
    s1_desc:   val('s1-desc'),
    s1_vol:    val('s1-vol'),
    s1_people: val('s1-people'),
    s1_space:  val('s1-space'),
    s1_driver: val('s1-driver'),
    s2_gate:   state.gates['s2'] || 'not answered',
    s2_desc:   val('s2-desc'),
    s3_gate:   state.gates['s3'] || 'not answered',
    s3_desc:   val('s3-desc'),
    s4_gate:   state.gates['s4'] || 'not answered',
    s4_desc:   val('s4-desc'),
    s4_reg:    val('s4-reg'),
    s4_adj:    val('s4-adj'),
    s5_gate:   state.gates['s5'] || 'not answered',
    s5_desc:   val('s5-desc'),
    s5_cap:    val('s5-cap'),
    s6_gate:   state.gates['s6'] || 'not answered',
    s6_desc:   val('s6-desc'),
    s7_gate:   state.gates['s7'] || 'not answered',
    s7_desc:   val('s7-desc'),
    s8_gate:   state.gates['s8'] || 'not answered',
    s8_desc:   val('s8-desc'),
  };

  try {
    await fetch('https://script.google.com/macros/s/AKfycbwqMh_CvPLO4iiItyjvNK1LoY9S8M8CEUkUMJwB1FjzPqmytHQ_ANPEDMkrauo4tZxH/exec', {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
  } catch(err) {
    console.error('Submission error:', err);
  }

  clearAfterSubmit();
  document.getElementById('panel-summary').classList.remove('active');
  document.getElementById('submitted').classList.add('visible');
  currentSection = 'submitted';
}

function exportText() {
  const topics = ['s1','s2','s3','s4','s5','s6','s7','s8'];
  let text = `WORKPLACE SPECIAL REQUIREMENTS — DEEP DIVE SUBMISSION\n`;
  text += `======================================================\n\n`;
  text += `Submitted: ${new Date().toLocaleDateString()}\n\n`;

  text += `GROUP INFORMATION\n-----------------\n`;
  text += `Department: ${val('g-dept')}\n`;
  text += `Role: ${val('g-role')}\n`;
  text += `Location: ${val('g-location')}\n`;
  text += `Headcount: ${val('g-headcount')}\n`;
  text += `Current setup: ${val('g-setup')}\n`;
  text += `Time split: ${val('g-split')}\n`;
  text += `Staff without laptops: ${val('g-nolaptop')}\n\n`;

  text += `TOPIC RESPONSES\n---------------\n\n`;
  topics.forEach(t => {
    text += `${TOPIC_LABELS[t].toUpperCase()}\n`;
    const gate = state.gates[t];
    if (gate === 'yes' || !gate) {
      text += `Status: ${gate === 'yes' ? 'Standard solution applies — no exception' : 'Not answered'}\n\n`;
    } else {
      text += `Status: EXCEPTION FLAGGED\n`;
      text += `Description: ${val(t + '-desc')}\n`;
      if (val(t + '-vol')) text += `Volume: ${val(t + '-vol')}\n`;
      if (val(t + '-people')) text += `People affected: ${val(t + '-people')}\n`;
      if (val(t + '-driver')) text += `Driver: ${val(t + '-driver')}\n`;
      text += '\n';
    }
  });

  const blob = new Blob([text], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `special-requirements-${(val('g-dept') || 'team').replace(/\s+/g,'-')}.txt`;
  a.click();
}
</script>

</body>
</html>
